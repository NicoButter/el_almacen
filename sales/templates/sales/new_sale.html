{% extends 'base.html' %}

{% load static %}

{% block extra_styles %}
  <link href="{% static 'sales/css/new_sale_styles.css' %}" rel="stylesheet"/>
{% endblock %}

{% block title %}Terminal de Venta{% endblock %}

{% block header_title %}
    Terminal de venta
{% endblock %}

{% block content %}

<button id="botonVoz">Activar Voz</button>
<div id="indicador" style="display:none;">üé§ Escuchando...</div>

<div class="container">
  <form method="post" id="sale-form">
    {% csrf_token %}
    <div class="row">
      <!-- Columna izquierda: Lista de productos escaneados -->
      <div class="section">
        <h2>Productos Agregados</h2>
        <ul id="product-list" class="list-group">
          <!-- Lista de productos agregados al carrito -->
          {% for item in scanned_items %}
            <li class="list-group-item">
              <!-- Contenedor de la fila -->
              <div class="product-info">
                <span class="product-name">{{ item.name }}</span>
                <div class="product-price">Precio: ${{ item.price }} / {{ item.unit }}</div>
              </div>
              <div class="product-quantity">
                <input type="number" min="1" value="{{ item.quantity }}" class="quantity-input">
              </div>
              <div class="product-total">
                <span class="product-subtotal">${{ item.subtotal }}</span>
              </div>
              <div class="product-remove">
                <button class="delete-button" data-item-id="{{ item.id }}">üóëÔ∏è</button>
              </div>
            </li>
          {% endfor %}
        </ul>        
      </div>

      <!-- Columna derecha: Esc√°ner QR y selecci√≥n de cliente -->
      <div class="section">
        <h2>Esc√°ner QR</h2>
        <div class="camera-container">
          <video id="video-bg" class="video-animation" autoplay loop muted>
            <source src="/static/sales/video/qr_scanner.mp4" type="video/mp4">
            Tu navegador no soporta el video.
          </video>
          <video id="video" autoplay></video> <!-- Este es el video de la c√°mara -->
          <canvas id="canvas" style="display: none"></canvas>
          <div class="laser-overlay"></div> <!-- Capa con animaci√≥n de l√°ser -->
        </div>
        <p id="scan-status">Esperando c√≥digo QR...</p>
      
      <!-- Contenedor de la imagen del producto escaneado -->
      <div id="product-image-container" style="display: none;">
          <img id="product-image" src="" alt="Producto Escaneado">
      </div>
        <!-- Formulario de b√∫squeda de productos -->
        <form id="search-form">
          <input type="text" id="search-input" name="search" placeholder="Buscar producto..." oninput="searchProducts()">
        </form>

        <!-- Contenedor para mostrar los resultados -->
        <div id="search-results"></div>

        <!-- Selecci√≥n de cliente y venta fiada -->
        <div class="field-group">
          <h4>Seleccionar Cliente</h4>
          <select id="cliente-select" name="cliente_id" class="select-field">
            <option value="">-- Seleccionar Cliente --</option>
            {% for cliente in clientes %}
              <option value="{{ cliente.id }}">{{ cliente.nombre }}</option>
            {% endfor %}
          </select>
          
          <div class="field-group">
            <h4>Seleccionar M√©todo de Pago</h4>
            <select id="payment-method" name="payment_method" class="select-field">
              <option value="">-- Seleccionar M√©todo de Pago --</option>
              <option value="efectivo">Efectivo</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="credito">Cr√©dito</option>
              <option value="fiado">Fiado</option> <!-- Opci√≥n para pago a cr√©dito -->
              <option value="otros">Otros</option>
            </select>
          </div>
        </div>
      </div>

    <div class="row">
      <div class="section flex-row">
        <h4>Total de la compra:</h4>
        <span id="total-compra">${{ total_amount }}</span> <!-- Se reemplaza con el total real -->
        <button type="submit" name="close_sale" class="button success">Cerrar Venta</button>
      </div>
    </div>
  <div class="row">
    <div class="section text-right">
      <a href="{% url 'cashier_dashboard' %}" class="button primary">Volver al Dashboard</a>
    </div>
  </div>
</div>

<!-- Incluye la biblioteca jsQR -->
<script src="{% static 'js/jsQR.js' %}"></script>

<script>

  document.addEventListener('DOMContentLoaded', function() {
    const modoVozBtn = document.getElementById('modo-voz');
    const indicador = document.getElementById('indicador');
    
    let modoVozActivo = false;

    // Funci√≥n para activar/desactivar modo de voz
    modoVozBtn.addEventListener('click', function() {
        modoVozActivo = !modoVozActivo;
        
        if (modoVozActivo) {
            modoVozBtn.textContent = 'Desactivar Voz'; // Cambia el texto del bot√≥n
            indicador.style.display = 'inline'; // Muestra el indicador de voz
        } else {
            modoVozBtn.textContent = 'Activar Voz'; // Cambia el texto del bot√≥n
            indicador.style.display = 'none'; // Oculta el indicador de voz
        }

        // Aqu√≠ puedes agregar la l√≥gica para iniciar o detener el reconocimiento de voz
    });
  });


  document.addEventListener('DOMContentLoaded', () => {
    const videoBg = document.getElementById('video-bg');;

    modoSelect.addEventListener('change', () => {
      if (modoSelect.value === 'voz') {
        modoVozButton.disabled = false;  // Habilitar el bot√≥n
      } else {
        modoVozButton.disabled = true;   // Deshabilitar el bot√≥n
      }
    });
    
    // Asegurarse de que el video de fondo se reproduzca al cargar la p√°gina
    const playVideo = () => {
      videoBg.play()
        .then(() => {
          console.log('Video de fondo reproduci√©ndose al cargar la p√°gina.');
        })
        .catch((error) => {
          console.error('Error al reproducir el video de fondo:', error);
        });
    };
  
    // Intentar reproducir el video
    playVideo();
  
    // Si el video no se reproduce al cargar la p√°gina, intentar nuevamente con un retraso
    setTimeout(playVideo, 1000);
  });

  const confirmSound = new Audio("/static/sounds/confirm.wav");
  const productosEscaneados = new Map();
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const context = canvas.getContext("2d");
  const scanStatus = document.getElementById("scan-status");
  const totalCompraElement = document.getElementById("total-compra");
  
  const productImageContainer = document.getElementById("product-image-container");
  const productImage = document.getElementById("product-image");
  
  let scanningEnabled = true; // Variable para controlar el escaneo
  
  navigator.mediaDevices.getUserMedia({ video: true })
    .then((stream) => {
      video.srcObject = stream;
      requestAnimationFrame(scanQRCode); // Asegura que el escaneo comienza cuando la c√°mara est√° activa
    })
    .catch((err) => {
      console.error('Error al acceder a la c√°mara:', err);
      scanStatus.textContent = "No se puede acceder a la c√°mara";
    });
  
  function scanQRCode() {
    if (!scanningEnabled) return; // Si el escaneo est√° deshabilitado, no hacemos nada
  
    // Configuraci√≥n del canvas para capturar la imagen del video
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    
    // Si encuentra un c√≥digo QR
    if (qrCode) {
      const productId = qrCode.data; // Asumiendo que el c√≥digo QR contiene el ID del producto
      agregarProductoALista(productId);
      confirmSound.play();
    } else {
      scanStatus.textContent = "Esperando c√≥digo QR...";
    }
  
    // Continuamos escaneando
    requestAnimationFrame(scanQRCode);
  }

  function agregarProductoALista(productId, cantidad = 1, esFraccionado = false) {
    const productIdStr = String(productId);
    const productList = document.getElementById("product-list");

    if (productosEscaneados.has(productIdStr)) {
        return;
    }

    // Mostrar la animaci√≥n de fondo al iniciar el escaneo
    showBackgroundVideo();

    fetch(`/sales/api/productos/${productIdStr}/`)
        .then(response => {
            if (!response.ok) {
                throw new Error("Error al obtener el producto");
            }
            return response.json();
        })
        .then(producto => {
            if (!producto || !producto.nombre || !producto.precio_venta) {
                console.error("Producto no v√°lido:", producto);
                return;
            }

            // Depurar la cantidad recibida
            console.log(`Producto: ${producto.nombre}, Cantidad: ${cantidad}`);

            // Actualizar el fondo de la c√°mara con la imagen del producto
            if (producto.imagen) {
                const cameraContainer = document.querySelector('.camera-container');
                cameraContainer.style.backgroundImage = `url(${producto.imagen})`;
                cameraContainer.style.backgroundColor = "transparent";

                // Vuelve a mostrar la animaci√≥n despu√©s de 2 segundos
                setTimeout(() => {
                    cameraContainer.style.backgroundImage = '';
                    showBackgroundVideo();
                }, 2000);
            }

            const li = document.createElement("li");
            li.className = "list-group-item";
            li.dataset.productId = productIdStr;

            const precio = parseFloat(producto.precio_venta.replace(',', '.'));
            let totalInicial;

            // Si el producto es fraccionado, usa el valor de esFraccionado (para comando de voz)
            if (esFraccionado) {
                totalInicial = precio * (cantidad / 1000); // Si es fraccionado, dividir por 1000
            } else {
                totalInicial = precio * cantidad; // Si no, multiplicar directamente
            }

            const precioTexto = esFraccionado ? "Precio x Kg" : "Precio x unidad";
            const unidadTexto = esFraccionado ? "grs" : "unidades";

            let inputCantidad;
            if (esFraccionado) {
                inputCantidad = `
                    <input type="number" min="10" max="5000" step="10" value="${cantidad}" 
                        onchange="actualizarCantidad('${productIdStr}', this.value, true)">
                    ${unidadTexto}
                `;
            } else {
                inputCantidad = `
                    <input type="number" min="1" value="${cantidad}" 
                        onchange="actualizarCantidad('${productIdStr}', this.value, false)">
                    unidades
                `;
            }

            li.innerHTML = `
                <div class="product-info">
                    <span class="product-name">${producto.nombre}</span>
                    <span class="product-price">${precioTexto}: $${precio.toFixed(2)}</span>
                </div>
                <div class="product-quantity">
                    ${inputCantidad}
                </div>
                <div class="product-total">
                    $<span class="costo">${totalInicial.toFixed(2)}</span>
                </div>
                <i class="fas fa-trash-alt eliminar" 
                    onclick="eliminarProducto('${productIdStr}', 1)" 
                    style="cursor: pointer; color: red; font-size: 20px;">
                </i>
            `;

            productList.appendChild(li);
            productosEscaneados.set(productIdStr, { 
                elemento: li, 
                cantidad: cantidad, 
                precio_venta: precio, 
                fraccionado: esFraccionado,  // Usamos esFraccionado para marcar si es fraccionado o no
                total: totalInicial 
            });
            actualizarTotalCompra();

            // Ocultar la animaci√≥n despu√©s de agregar el producto
            hideBackgroundVideo();

            // Construir el mensaje de audio
            let mensaje = `El producto ${producto.nombre}`;
            if (esFraccionado) {
                mensaje += ` en ${cantidad} gramos`; // A√±adir detalles de fraccionado si aplica
            } else {
                mensaje += ` en ${cantidad} unidades`; // A√±adir cantidad de unidades
            }

            console.log(mensaje);

            
            mensaje += " ha sido agregado a la lista.";

            // Llamar a la funci√≥n para reproducir el mensaje en voz alta
            reproducirAudio(mensaje);
        })
        .catch(error => {
            console.error("Error:", error);
            hideBackgroundVideo(); // Ocultar la animaci√≥n en caso de error
        });
}

function reproducirAudio(mensaje) {
  console.log("Reproduciendo mensaje:", mensaje);  // Verificar que el mensaje se est√° construyendo correctamente
  const utterance = new SpeechSynthesisUtterance(mensaje);
  utterance.lang = 'es-ES';
  window.speechSynthesis.speak(utterance);
}


// Mostrar la animaci√≥n
function showBackgroundVideo() {
  const videoBg = document.getElementById('video-bg');
  videoBg.currentTime = 0; // Reinicia el video
  videoBg.style.display = 'block'; // Aseg√∫rate de mostrarlo
  videoBg.play().catch((error) => console.error('Error al reproducir el video:', error));
}

// Ocultar la animaci√≥n
function hideBackgroundVideo() {
  const videoBg = document.getElementById('video-bg');
  videoBg.style.display = 'none';
  videoBg.pause(); // Pausa para evitar usar recursos innecesarios
}

  function scanQRCode() {
    if (video.readyState === video.HAVE_ENOUGH_DATA && scanningEnabled) {
      canvas.height = video.videoHeight;
      canvas.width = video.videoWidth;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(imageData.data, canvas.width, canvas.height);

      if (code && code.data) {
        scanStatus.textContent = `Producto escaneado: ${code.data}`;
        agregarProductoALista(code.data);
        confirmSound.play();

        scanningEnabled = false;
        setTimeout(() => {
          scanningEnabled = true;
        }, 3000);
      } else {
        scanStatus.textContent = "Esperando c√≥digo QR...";
      }
    }

    requestAnimationFrame(scanQRCode);
  }

  function actualizarCantidad(productIdStr, nuevaCantidad, esFraccionado) {
    const producto = productosEscaneados.get(productIdStr);
    if (!producto) return;

    const precio = producto.precio_venta;
    let costoTotal;

    if (esFraccionado) {
      const cantidadEnKilos = nuevaCantidad / 1000;
      costoTotal = precio * cantidadEnKilos;
    } else {
      costoTotal = precio * nuevaCantidad;
    }

    producto.elemento.querySelector('.costo').textContent = costoTotal.toFixed(2);
    producto.cantidad = nuevaCantidad;
    producto.total = costoTotal;
    actualizarTotalCompra();
  }

  function eliminarProducto(id, cantidad) {
    const item = productosEscaneados.get(id);
    if (item) {
      if (item.cantidad > 1) {
        item.cantidad -= cantidad;
        actualizarLista(item);
      } else {
        productosEscaneados.delete(id);
        const productList = document.getElementById("product-list");
        const items = productList.getElementsByTagName("li");
        for (let i = 0; i < items.length; i++) {
          if (items[i].dataset.productId === id) {
            productList.removeChild(items[i]);
            break;
          }
        }
      }
      actualizarTotalCompra();
    }
  }

  function actualizarTotalCompra() {
    let total = 0;
    productosEscaneados.forEach(producto => {
      total += producto.total;
    });
    totalCompraElement.textContent = `$${total.toFixed(2)}`;
  }

  // Evento para procesar el formulario y enviar la venta
  document.getElementById("sale-form").addEventListener("submit", (e) => {
    e.preventDefault();

    const clienteId = document.getElementById("cliente-select").value;
    if (!clienteId) {
      alert("Debes seleccionar un cliente para continuar.");
      return;
    }

    const productosData = Array.from(productosEscaneados.values()).map(producto => ({
      id: parseInt(producto.elemento.dataset.productId),
      cantidad: producto.cantidad,
      total: producto.total,
      precio_unitario: producto.precio_venta 
    }));
    
    // Calcular el total de la compra sumando los totales de los productos
    const totalCompra = productosData.reduce((total, producto) => total + producto.total, 0);
    const ventaFiada = document.getElementById("venta-fiada").value || ''; 

    const data = {
      cliente_id: parseInt(clienteId),
      productos: productosData,
      total: parseFloat(totalCompra) || 0,
      venta_fiada: ventaFiada
    };

    console.log("Objeto JSON que se enviar√° al backend:", data);

    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    fetch("/sales/api/realizar-venta/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrfToken
      },
      body: JSON.stringify(data)
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert("Venta registrada con √©xito");
          window.location.href = `/sales/tickets/${data.ticket_id}/`;
        } else {
          alert("Error al registrar la venta");
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Hubo un problema al procesar la venta.");
      });
  });

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  function searchProducts() {
    const query = document.getElementById("search-input").value;

    if (query.length > 2) {  // Solo hacer la b√∫squeda si el texto tiene m√°s de 2 caracteres
        fetch(`/sales/api/search_products/?query=${encodeURIComponent(query)}`, {
            method: "GET",
        })
        .then(response => response.json())
        .then(data => {
            let resultsHtml = '';
            if (data.products.length > 0) {
                data.products.forEach(product => {
                    resultsHtml += `
                        <div class="product-result" onclick="agregarProductoALista(${product.id})">
                            <span>${product.nombre}</span>
                            <span>$${product.precio_venta}</span>
                        </div>
                    `;
                });
            } else {
                resultsHtml = '<p>No se encontraron productos.</p>';
            }
            document.getElementById("search-results").innerHTML = resultsHtml;
        })
        .catch(error => console.error('Error en la b√∫squeda:', error));
    } else {
        document.getElementById("search-results").innerHTML = '';  // Limpiar resultados si la b√∫squeda es vac√≠a
    }
}

</script>

<script>
   // Funci√≥n para buscar el producto por nombre y obtener su ID
  function buscarProductoPorNombre(nombreProducto, cantidad, esFraccionado) {
    // Realizamos una b√∫squeda por el nombre del producto    
    fetch(`/sales/api/search_products/?query=${encodeURIComponent(nombreProducto)}`)
      .then(response => response.json())
      .then(data => {
        let producto = null;
        // Buscamos el primer producto en los resultados
        if (data.products.length > 0) {
          producto = data.products[0];  // Suponemos que solo hay un resultado relevante
          console.log("Producto encontrado:", producto);
          console.log("Producto encontrado ID:", producto.id);
          // Pasamos el ID del producto a la funci√≥n agregarProductoALista
          agregarProductoALista(producto.id, cantidad, esFraccionado); // Llamamos con el ID del producto
        } else {
          console.log("Producto buscado:" . nombreProducto . cantidad . esFraccionado);
        }
      })
      .catch(error => {
        console.error("Error al buscar el producto:", error);
      });
  }

  function procesarComandoDeVoz(comando) {
    console.log("Comando recibido en procesarComandoDeVoz:", comando);
  
    // Normalizamos el comando para evitar errores por may√∫sculas/min√∫sculas
    const palabras = comando.trim().toLowerCase().split(' ');
  
    // Verificamos si el comando comienza con "madre producto"
    if (palabras[0] !== "madre" || palabras[1] !== "producto") {
      console.error("Comando inv√°lido, debe comenzar con 'madre producto'");
      return;
    }
  
    // Inicializamos las variables para el nombre, cantidad y tipo de fracci√≥n
    let nombreProducto = "";
    let cantidad = 1; // Valor por defecto
    let esFraccionado = false;
  
    // Diccionario para convertir n√∫meros escritos como texto a valores num√©ricos
    const numerosComoTexto = {
      "uno": 1,
      "dos": 2,
      "tres": 3,
      "cuatro": 4,
      "cinco": 5,
      "seis": 6,
      "siete": 7,
      "ocho": 8,
      "nueve": 9,
      "diez": 10
    };
  
    // Revisamos la √∫ltima palabra para determinar si es cantidad o tipo de fracci√≥n
    const ultimaPalabra = palabras[palabras.length - 1];
    const penultimaPalabra = palabras.length > 2 ? palabras[palabras.length - 2] : "";
  
    if (!isNaN(ultimaPalabra)) {
      // Si la √∫ltima palabra es un n√∫mero, la tomamos como cantidad
      cantidad = parseFloat(ultimaPalabra);
      nombreProducto = palabras.slice(2, -1).join(" ");
    } else if (numerosComoTexto[ultimaPalabra]) {
      // Si la √∫ltima palabra es un n√∫mero en texto, lo convertimos a cantidad
      cantidad = numerosComoTexto[ultimaPalabra];
      nombreProducto = palabras.slice(2, -1).join(" ");
    } else if (ultimaPalabra === "gramos" || ultimaPalabra === "kilos" || ultimaPalabra === "kilo") {
      // Si la √∫ltima palabra es "gramos" o "kilos", el producto es fraccionado
      esFraccionado = true;

      // Si la pen√∫ltima palabra es un n√∫mero, la usamos como cantidad
      if (!isNaN(penultimaPalabra)) {
        cantidad = parseFloat(penultimaPalabra);
      } else if (numerosComoTexto[penultimaPalabra]) {
        cantidad = numerosComoTexto[penultimaPalabra];
      } else {
        console.error("No se especific√≥ una cantidad v√°lida para un producto fraccionado");
        return;
      }
  
      if (ultimaPalabra === "kilos") {
        cantidad *= 1000; // Convertimos kilos a gramos
      }
  
      // El nombre del producto es todo lo que est√° antes de la cantidad
      nombreProducto = palabras.slice(2, -2).join(" ");
    } else {
      // Si no hay cantidad espec√≠fica, asumimos 1 unidad
      nombreProducto = palabras.slice(2).join(" ");
    }
  
    // Validamos que al menos tengamos un nombre de producto
    if (!nombreProducto) {
      console.error("No se detect√≥ un nombre de producto en el comando");
      return;
    }
  
    console.log("Nombre del producto limpio:", nombreProducto.trim());
    console.log("Cantidad:", cantidad, "Es fraccionado:", esFraccionado);
  
    // Llamamos a la funci√≥n para buscar y procesar el producto
    buscarProductoPorNombre(nombreProducto, cantidad, esFraccionado);
}
 
// Reconocimiento de voz
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
  const recognition = new SpeechRecognition();
  recognition.lang = 'es-ES'; // Configurar idioma espa√±ol
  recognition.continuous = false; // Escuchar un comando a la vez
  recognition.interimResults = false; // Solo resultados finales

  // Variables para controlar el estado del reconocimiento
  let vozActivada = false; // Indica si el modo voz est√° activado

  const botonVoz = document.getElementById("botonVoz"); // Bot√≥n de activaci√≥n/desactivaci√≥n
  const indicador = document.getElementById("indicador"); // Indicador visual

  // Activar/desactivar el reconocimiento de voz
  botonVoz.addEventListener('click', () => {
    if (!vozActivada) {
      // Activar modo voz
      vozActivada = true;
      indicador.style.display = 'block'; // Mostrar indicador
      botonVoz.textContent = "Modo Voz Activado";
      console.log("Reconocimiento de voz activado.");
      recognition.start(); // Iniciar el reconocimiento
    } else {
      // Desactivar manualmente
      vozActivada = false;
      indicador.style.display = 'none'; // Ocultar indicador
      botonVoz.textContent = "Activar Voz";
      recognition.stop(); // Detener reconocimiento
      console.log("Reconocimiento de voz desactivado manualmente.");
    }
  });

  // Procesar resultado del reconocimiento
  recognition.addEventListener('result', (event) => {
    const comando = event.results[0][0].transcript.toLowerCase().trim();
    console.log(`Comando reconocido: ${comando}`);
    
    if (comando.startsWith("madre producto")) {
      // Procesar comando para agregar producto
      procesarComandoDeVoz(comando);
    } else if (comando === "madre terminar") {
      // Detener el modo voz
      vozActivada = false;
      recognition.stop();
      indicador.style.display = 'none';
      botonVoz.textContent = "Activar Voz";
      console.log("Reconocimiento de voz desactivado por comando.");
    } else {
      console.log("Comando no reconocido.");
    }
  });

  // Despu√©s de procesar un comando, reiniciar si el modo voz sigue activado
  recognition.addEventListener('end', () => {
    if (vozActivada) {
      console.log("Esperando un nuevo comando...");
      recognition.start(); // Reiniciar reconocimiento para un nuevo comando
    } else {
      console.log("Reconocimiento de voz detenido.");
    }
  });

  // Manejo de errores de reconocimiento
  recognition.addEventListener('error', (event) => {
    console.error('Error en reconocimiento de voz:', event.error);
    indicador.style.display = 'none';
    botonVoz.textContent = "Activar Voz"; // Restaurar el texto del bot√≥n en caso de error
  });
} else {
  alert('Tu navegador no soporta reconocimiento de voz.');
  console.log('El navegador no soporta reconocimiento de voz.');
}

</script>

{% endblock %}