{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block extra_styles %}
<link href="{% static 'dashboards/css/admin_dashboard_styles.css' %}" rel="stylesheet">
{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}
<div class="dashboard-fullwidth-container">
    <div class="dashboard-shell">
        <aside class="dashboard-sidebar glass-custom">
            <div class="sidebar-header">
                <img src="{% static 'images/el_almacen_logo.png' %}" alt="El Almacén" class="sidebar-logo">
                <div class="sidebar-business">
                    <span class="business-name">El Almacén</span>
                    <span class="business-tagline">Panel administrativo</span>
                </div>
            </div>
            <nav class="sidebar-nav" aria-label="Navegación principal">
                <a href="{% url 'dashboard:admin_dashboard' %}" class="sidebar-link{% if request.resolver_match.url_name == 'admin_dashboard' %} is-active{% endif %}" {% if request.resolver_match.url_name == 'admin_dashboard' %}aria-current="page"{% endif %}>
                    <span class="sidebar-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="7" height="7" rx="1.2" stroke="currentColor" stroke-width="1.5"/>
                            <rect x="14" y="3" width="7" height="7" rx="1.2" stroke="currentColor" stroke-width="1.5"/>
                            <rect x="3" y="14" width="7" height="7" rx="1.2" stroke="currentColor" stroke-width="1.5"/>
                            <rect x="14" y="14" width="7" height="7" rx="1.2" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </span>
                    <span class="sidebar-label">Dashboard</span>
                </a>
                <a href="{% url 'listar_productos' %}" class="sidebar-link{% if request.resolver_match.url_name == 'listar_productos' %} is-active{% endif %}" {% if request.resolver_match.url_name == 'listar_productos' %}aria-current="page"{% endif %}>
                    <span class="sidebar-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 16V8a1 1 0 0 0-.553-.894l-8-4a1 1 0 0 0-.894 0l-8 4A1 1 0 0 0 3 8v8a1 1 0 0 0 .553.894l8 4a1 1 0 0 0 .894 0l8-4A1 1 0 0 0 21 16z" stroke="currentColor" stroke-width="1.4"/>
                            <path d="M3.27 6.96 12 11l8.73-4.04" stroke="currentColor" stroke-width="1.4"/>
                        </svg>
                    </span>
                    <span class="sidebar-label">Productos</span>
                </a>
                <a href="{% url 'listar_clientes' %}" class="sidebar-link{% if request.resolver_match.url_name == 'listar_clientes' %} is-active{% endif %}" {% if request.resolver_match.url_name == 'listar_clientes' %}aria-current="page"{% endif %}>
                    <span class="sidebar-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </span>
                    <span class="sidebar-label">Clientes</span>
                </a>
                <a href="{% url 'sales:ticket_list' %}" class="sidebar-link{% if request.resolver_match.url_name == 'ticket_list' %} is-active{% endif %}" {% if request.resolver_match.url_name == 'ticket_list' %}aria-current="page"{% endif %}>
                    <span class="sidebar-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </span>
                    <span class="sidebar-label">Ventas</span>
                </a>
                <a href="{% url 'reports_dashboard' %}" class="sidebar-link{% if request.resolver_match.url_name == 'reports_dashboard' %} is-active{% endif %}" {% if request.resolver_match.url_name == 'reports_dashboard' %}aria-current="page"{% endif %}>
                    <span class="sidebar-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 19v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </span>
                    <span class="sidebar-label">Reportes</span>
                </a>
            </nav>
        </aside>

        <main class="dashboard-main">
            <header class="dashboard-header">
                <div class="header-content">
                    <h1 class="page-title">
                        <span class="title-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                                <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="1.5"/>
                                <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                        </span>
                        Historial de Ventas
                    </h1>
                    <p class="page-subtitle">Revisa todas las transacciones realizadas</p>
                </div>
            </header>

            <div class="metrics-grid">
                <div class="metric-card glass-custom">
                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value">{{ total_tickets|intcomma }}</div>
                        <div class="metric-label">Total Tickets</div>
                    </div>
                </div>

                <div class="metric-card glass-custom">
                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value">${{ total_ventas|floatformat:0|intcomma }}</div>
                        <div class="metric-label">Total Ventas</div>
                    </div>
                </div>

                <div class="metric-card glass-custom">
                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value">{{ tickets_hoy|intcomma }}</div>
                        <div class="metric-label">Tickets Hoy</div>
                    </div>
                </div>

                <div class="metric-card glass-custom">
                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M22 2l-1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 8l-1-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 2l1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 8l1-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value">${{ promedio_ticket|floatformat:0|intcomma }}</div>
                        <div class="metric-label">Promedio Ticket</div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                                <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="1.5"/>
                                <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                        </span>
                        Lista de Tickets
                    </h2>
                    <div class="section-actions">
                        <a href="{% url 'sales:new_sale' %}" class="btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="btn-icon">
                                <path d="M12 4v16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M4 12h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            Nueva Venta
                        </a>
                    </div>
                </div>

                <div class="data-table-container glass-custom">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID Ticket</th>
                                <th>Cajero</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th class="actions-column">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ticket in tickets %}
                            <tr>
                                <td>{{ ticket.id }}</td>
                                <td>{{ ticket.cashier.username }}</td>
                                <td>{{ ticket.date|date:"d/m/Y H:i" }}</td>
                                <td>${{ ticket.total|floatformat:2 }}</td>
                                <td class="actions-column">
                                    <div class="action-buttons">
                                        <a href="{% url 'sales:ticket_detail' ticket.id %}" class="action-btn view-btn" title="Ver Detalles">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </a>
                                        <a href="{% url 'sales:reprint_ticket' ticket.id %}" class="action-btn print-btn" title="Reimprimir">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6 9V2h12v7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" stroke="currentColor" stroke-width="1.5"/>
                                                <rect x="6" y="14" width="12" height="8" rx="1" ry="1" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

{% endblock %}
