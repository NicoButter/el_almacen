{% extends 'base.html' %}
{% block title %}Reporte de Cuentas Corrientes{% endblock %}
{% block content %}

<div class="container mt-4">
  <h1 class="text-center mb-4">Reporte de Cuentas Corrientes</h1>

  <!-- Formulario para buscar por cliente -->
  <form method="GET" action="">
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label for="busqueda" class="form-label">Buscar por Nombre, Email o Teléfono:</label>
            <input type="text" id="busqueda" name="busqueda" class="form-control" value="{{ busqueda }}" placeholder="Ingrese nombre, email o teléfono">
        </div>
        <div class="col-md-3 align-self-end">
            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i></button>
        </div>
    </div>
  </form>
  
  {% if cuentas_corrientes %}
    <ul>
      {% for cuenta in cuentas_corrientes %}
        <li>{{ cuenta.cliente.nombre }}</li>
        <ul>
          <li><strong>Saldo:</strong> ${{ cuenta.saldo|floatformat:2 }}</li>
          <li><strong>Fecha Apertura:</strong> {{ cuenta.fecha_apertura }}</li>
        </ul>
      {% endfor %}
    </ul>
  {% else %}
    <p>No se encontraron cuentas corrientes.</p>
  {% endif %}

  <!-- Información resumen -->
  <div class="row text-center mb-4">
    <div class="col-md-4">
      <h3>Total Cuentas Corrientes</h3>
      <p class="fw-bold">{{ total_cuentas }}</p>
    </div>
    <div class="col-md-4">
      <h3>Saldo Total</h3>
      <p class="fw-bold">${{ saldo_total|floatformat:2 }}</p>
    </div>
    <div class="col-md-4">
      <h3>Monto Total Fiado</h3>
      <!-- Eliminar monto_total_fiado ya que no se necesita más -->
      <p class="fw-bold">${{ saldo_total|floatformat:2 }}</p> 
    </div>
  </div>

  <!-- Tabla con las cuentas corrientes -->
  <table class="table table-striped table-hover">
    <thead class="table-primary">
      <tr>
        <th scope="col">Cliente</th>
        <th scope="col">Saldo</th>
        <th scope="col">Fecha Apertura</th>
        <th scope="col">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for cuenta in cuentas_corrientes %}
        <tr>
          <td>{{ cuenta.cliente.nombre }}</td>
          <td>${{ cuenta.saldo|floatformat:2 }}</td>
          <td>{{ cuenta.fecha_apertura }}</td>
          <td>
            <a href="{% url 'cuenta_detalle' cuenta.id %}" title="Ver Detalles">
                <i class="fas fa-eye"></i> <!-- Ícono de un ojo -->
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="text-center">No hay cuentas corrientes disponibles.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Botón para generar PDF -->
  <div class="text-end mt-4">
    {% comment %} <a href="{% url 'reporte_cuentas_corrientes_pdf' %}" class="btn btn-primary">Generar PDF</a> {% endcomment %}
  </div>
</div>

<div class="text-end mt-4">
    <a href="{% url 'reports_dashboard' %}" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left"></i> Volver
    </a>
</div>

{% endblock %}
