{% extends 'base.html' %}
{% block title %}Reporte de Inventario{% endblock %}
{% block content %}

<h1>Reporte de Inventario</h1>

<!-- Formulario de Filtros -->
<form method="GET" action="{% url 'inventory_report' %}">
  <div class="mb-3">
    <label for="categoria" class="form-label">Categoría:</label>
    <select name="categoria" id="categoria" class="form-select">
      <option value="">Todas las categorías</option>
      {% for categoria in categorias %}
        <option value="{{ categoria.id }}" {% if categoria.id == request.GET.categoria %}selected{% endif %}>
          {{ categoria.nombre }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="min_stock" class="form-label">Mínimo en stock:</label>
    <input type="number" name="min_stock" id="min_stock" class="form-control" value="{{ request.GET.min_stock }}">
  </div>

  <button type="submit" class="btn btn-primary">Filtrar</button>
</form>

<!-- Tabla de Inventario -->
<table class="table table-striped mt-4">
  <thead>
    <tr>
      <th>Producto</th>
      <th>Descripción</th>
      <th>Costo</th>
      <th>Porcentaje de Ganancia</th>
      <th>Precio de Venta</th>
      <th>Cantidad en Stock</th>
      <th>Se Vende Fraccionado</th>
      <th>Categoría</th>
    </tr>
  </thead>
  <tbody>
    {% for producto in productos %}
    <tr>
      <td>{{ producto.nombre }}</td>
      <td>{{ producto.descripcion }}</td>
      <td>${{ producto.costo|floatformat:2 }}</td>
      <td>{{ producto.porcentaje_ganancia }}%</td>
      <td>${{ producto.precio_venta|floatformat:2 }}</td>
      <td>{{ producto.cantidad_stock }}</td>
      <td>{{ producto.se_vende_fraccionado|yesno:"Sí,No" }}</td>
      {% if producto.categoria %}
        <td>{{ producto.categoria.nombre }}</td>
      {% else %}
        <td>Sin categoría</td>
      {% endif %}
    </tr>
    {% empty %}
    <tr>
      <td colspan="8">No hay productos disponibles.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Botón para generar PDF -->
<div class="text-end mt-4">
  <a href="{% url 'inventory_report_pdf' %}" class="btn btn-primary">Generar PDF</a>
</div>

{% endblock %}
